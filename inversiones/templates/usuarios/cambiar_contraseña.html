{% extends 'base.html' %}

{% block title %}Cambiar contrase√±a{% endblock %}

{% block content %}
<style>
  .password-card {
    background-color: #fbc02d;
    border-radius: 15px;
    box-shadow: 0 8px 16px rgba(251, 192, 45, 0.4);
    padding: 2rem;
    max-width: 450px;
    width: 100%;
  }
  .password-card label {
    font-weight: 600;
    color: #333;
  }
  .password-card input {
    border-radius: 8px;
    border: 1px solid #d1b200;
    padding: 10px 40px 10px 12px; /* espacio para el √≠cono */
    width: 100%;
    box-sizing: border-box;
  }
  .password-card input:focus {
    outline: none;
    border-color: #b38f00;
    box-shadow: 0 0 8px #b38f00;
  }
  .btn-password {
    background-color: #333;
    color: #fbc02d;
    font-weight: 700;
    border: none;
    border-radius: 8px;
    padding: 12px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  .btn-password:hover {
    background-color: #222;
  }

  /* Bot√≥n mostrar/ocultar contrase√±a */
  .toggle-password {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    cursor: pointer;
    font-size: 18px;
    color: #333;
  }
  .password-wrapper {
    position: relative;
    width: 100%;
  }
</style>

<div class="d-flex justify-content-center align-items-center" style="min-height: 90vh; background-color: #fff8e1;">
  <div class="card shadow-lg border-0 password-card">
    <div class="card-body p-4">
      <h3 class="text-center mb-4 text-dark">Cambiar contrase√±a</h3>

      {% if messages %}
      <div class="mb-3">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} text-center py-2">
          {{ message }}
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <form method="POST" novalidate>
        {% csrf_token %}
        {{ form.non_field_errors }}

        <div class="mb-3 password-wrapper">
          {{ form.old_password.label_tag }}
          {{ form.old_password }}
          <button type="button" class="toggle-password" onclick="togglePassword('id_old_password', this)">üëÅ</button>
          {% if form.old_password.errors %}
          <small class="text-danger">{{ form.old_password.errors.0 }}</small>
          {% endif %}
        </div>

        <div class="mb-3 password-wrapper">
          {{ form.new_password1.label_tag }}
          {{ form.new_password1 }}
          <button type="button" class="toggle-password" onclick="togglePassword('id_new_password1', this)">üëÅ</button>
          {% if form.new_password1.errors %}
          <small class="text-danger">{{ form.new_password1.errors.0 }}</small>
          {% endif %}
        </div>

        <div class="mb-3 password-wrapper">
          {{ form.new_password2.label_tag }}
          {{ form.new_password2 }}
          <button type="button" class="toggle-password" onclick="togglePassword('id_new_password2', this)">üëÅ</button>
          {% if form.new_password2.errors %}
          <small class="text-danger">{{ form.new_password2.errors.0 }}</small>
          {% endif %}
        </div>

        <button type="submit" class="btn btn-dark w-100 btn-password">Cambiar contrase√±a</button>
      </form>

      <!-- Bot√≥n Volver Atr√°s -->
      <div class="mt-3">
        <a href="{{ request.META.HTTP_REFERER|default:'/perfil/' }}" class="btn btn-outline-secondary w-100">
            Volver Atr√°s
        </a>
      </div>

    </div>
  </div>
</div>

<script>
function togglePassword(fieldId, btn) {
  const field = document.getElementById(fieldId);
  if (field.type === "password") {
    field.type = "text";
    btn.textContent = "üôà";
  } else {
    field.type = "password";
    btn.textContent = "üëÅ";
  }
}
</script>
{% endblock %}
